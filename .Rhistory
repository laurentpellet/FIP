fwrite(DATA[itunes!="",.(SOUNDIIZ=sprintf("%s - %s %s", Artist, Song, itunes))][1:20], "testImport.csv", sep=";")
fwrite(DATA[itunes!="",.(SOUNDIIZ=sprintf("%s",itunes))][1:20], "testImport.csv", sep=";")
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
## CONSOLIDATIONS
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
SOUSRADIO <- "radio-jazz"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
## CONSOLIDATIONS
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=paste(itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=paste(itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=paste(itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, itunes)))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s %s", Artist, Song, itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s %s", Artist, Song, itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s %s", Artist, Song, itunes))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
SOUSRADIO <- "radio-jazz"  #fip, radio-reggae, radio-jazz
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
(DATA
DATA
DATA[itunes!="",.(SOUNDIIZ=sprintf("%s",itunes))][1:200]
fwrite(DATA[itunes!="",.(SOUNDIIZ=sprintf("%s",itunes))][1:200], "testImport.csv", sep=";")
View(DATA)
View(FIP.REGGAE)
SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lstMois
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
source("functions.R")
#SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
## APPELS API
dt <- Sys.Date()
for(i in 0:2) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
## APPELS API
dt <- Sys.Date()
i <- 0
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
date <- Sys.Date()
i <- 1
curs <- NULL
ts <- as.numeric(as.POSIXct(date)+10*3600)
js <- FIP.getSongs(ts, curs)
DATA <- FIP.jsonToDT(js)
curs <- js$`next`
while(!is.null(curs) & js$songs[[1]]$end<=ts+24*3600) {
cat(curs)
js <- FIP.getSongs(ts, curs)
if(length(js$songs)>0){
DATA2 <- FIP.jsonToDT(js)
DATA <- rbind(DATA, DATA2, fill=T)
}
curs <- js$`next`
}
DATA
DATA[,start:=as.POSIXct(start, tz="Pacific/Tahiti")]
DATA[,end:=as.POSIXct(end, tz="Pacific/Tahiti")]
DATA
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
## APPELS API
dt <- Sys.Date()
for(i in 1:2) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
DATA
DATA
DATA
DATA <- fread("output/fip/SONGS-fip-2024-05-25.csv")
DATA[order(start)][itunes!="",.(SOUNDIIZ=paste(Artist, Song, sep=" - "))], sprintf("output/soundiiz/FIP-itunesonly-%s.csv", SOUSRADIO)
DATA[order(start)][itunes!="",.(SOUNDIIZ=paste(Artist, Song, sep=" - "))]
i<-0
date <- Sys.Date()
i <- 1
curs <- NULL
ts <- as.numeric(as.POSIXct(date)+10*3600)
js <- FIP.getSongs(ts, curs)
DATA <- FIP.jsonToDT(js)
curs <- js$`next`
while(!is.null(curs) & js$songs[[1]]$end<=ts+24*3600) {
cat(curs)
js <- FIP.getSongs(ts, curs)
if(length(js$songs)>0){
DATA2 <- FIP.jsonToDT(js)
DATA <- rbind(DATA, DATA2, fill=T)
}
curs <- js$`next`
}
cat(as.character(dt-i))
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
View(DATA)
i <- 1
curs <- NULL
ts <- as.numeric(as.POSIXct(date)+10*3600)
js <- FIP.getSongs(ts, curs)
DATA <- FIP.jsonToDT(js)
curs <- js$`next`
while(!is.null(curs) & js$songs[[1]]$end<=ts+24*3600) {
cat(curs)
js <- FIP.getSongs(ts, curs)
if(length(js$songs)>0){
DATA2 <- FIP.jsonToDT(js)
DATA <- rbind(DATA, DATA2, fill=T)
}
curs <- js$`next`
}
DATA[,start:=as.POSIXct(start, tz="Pacific/Tahiti")]
DATA[,end:=as.POSIXct(end, tz="Pacific/Tahiti")]
DATA
fwrite(DATA[order(start)][itunes!="",.(SOUNDIIZ=paste(Artist, Song, sep=" - "))], sprintf("output/soundiiz/FIP-itunesonly-%s.csv", SOUSRADIO))
DATA[mois==x,.(SOUNDIIZ=paste(Artist, Song, sep=" - "))]
DATA[itunes!="",.(SOUNDIIZ=sprintf("%s",itunes))][1:200]
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
fwrite(DATA[order(start)][,.(SOUNDIIZ=paste(Artist, Song, sep=" - "))], sprintf("output/soundiiz/FIP-%s.csv", SOUSRADIO))
## APPELS API
dt <- Sys.Date()
for(i in 2:15) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
## APPELS API
dt <- Sys.Date()-15
dt
## APPELS API
dt <- Sys.Date()-17
dt
## APPELS API
dt <- Sys.Date()-19
dt
## APPELS API
dt <- Sys.Date()-19
for(i in 0:8) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
## ANALYSE
FIP <-  readRDS("output/SONGS-fip-2024.rds")
FIP.JAZZ <-  readRDS("output/SONGS-radio-jazz-2024.rds")
FIP.REGGAE <-  readRDS("output/SONGS-radio-reggae-2024.rds")
SONGS <- rbindlist(list(FIP, FIP.JAZZ, FIP.REGGAE), use.names = T , fill=T)
SONGS[, .N, Artist][order(-N)][1:20]
## ANALYSE
FIP <-  readRDS("output/SONGS-fip-2024.rds")
FIP[, .N, Artist][order(-N)][1:20]
View(FIP)
FIP[Artist=="Calexico"]
list.files(path="output/fip")
listDatesFIP <- list.files(path="output/fip")
listDatesFIP <- substring(listDatesFIP,20,30)
listDatesFIP
listDatesFIP <- list.files(path="output/fip")
substring(listDatesFIP,15,30)
substring(listDatesFIP,13,30)
substring(listDatesFIP,13,18)
substring(listDatesFIP,13,20)
substring(listDatesFIP,11,20)
as.Date(substring(listDatesFIP,11,20))
listDatesFIP <- list.files(path="output/fip")
listDatesFIP <- as.Date(substring(listDatesFIP,11,20))
listDatesFIP
seq.Date(from='2024-01-01', to="2025-05-27")
seq.Date(from=as.Date('2024-01-01'), to=as.Date("2025-05-27"))
seq.Date(from=as.Date('2024-01-01'), to=as.Date("2025-05-27"), by = 1)
seq.Date(from=as.Date('2024-01-01'), to=as.Date("2024-05-27"), by = 1)
allDates <- seq.Date(from=as.Date('2024-01-01'), to=as.Date("2024-05-27"), by = 1)
setdiff(allDates, listDatesFIP)
as.Date(setdiff(allDates, listDatesFIP))
lstDatesFIP <- list.files(path="output/fip")
lstDatesFIP <- as.Date(substring(lstDatesFIP,11,20))
lstAllDates <- seq.Date(from=as.Date('2024-01-01'), to=as.Date("2024-05-27"), by = 1)
lstDatesManquantes <- as.Date(setdiff(lstAllDates, lstDatesFIP))
for(dt in lstDatesManquantes) {
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
source("functions.R")
for(dt in lstDatesManquantes) {
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
for(dt in lstDatesManquantes) {
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
#SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
for(dt in lstDatesManquantes) {
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
for(dt in lstDatesManquantes) {
cat(as.character(dt))
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
as.character(asDate(dt))
as.character(as.Date(dt))
for(dt in lstDatesManquantes) {
cat(as.character(as.Date(dt)))
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
FIP.getSongForDay(dt)
lstDatesFIP <- list.files(path="output/fip")
lstDatesFIP <- as.Date(substring(lstDatesFIP,11,20))
lstAllDates <- seq.Date(from=as.Date('2024-01-01'), to=as.Date("2024-05-27"), by = 1)
lstDatesManquantes <- as.character(setdiff(lstAllDates, lstDatesFIP))
lstDatesManquantes
lstDatesManquantes <- as.character(as.Date(setdiff(lstAllDates, lstDatesFIP)))
lstDatesManquantes
for(dt in lstDatesManquantes) {
cat(as.character(as.Date(dt)))
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
View(DATA)
## ECRITURE D'UN FICHIER PAR MOIS
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
## ANALYSE
FIP <-  readRDS("output/SONGS-fip-2024.rds")
FIP[, .N, Artist][order(-N)][1:20]
lstDatesFIP <- list.files(path="output/fip")
lstDatesFIP <- as.Date(substring(lstDatesFIP,11,20))
lstAllDates <- seq.Date(from=as.Date('2024-05-28'), to=as.Date("2024-08-24"), by = 1)
lstDatesManquantes <- as.character(as.Date(setdiff(lstAllDates, lstDatesFIP)))
library(httr2)
library(data.table)
library(openxlsx2)
FIP.getSongs <- function(ts, curs=NULL) {
req <- request(URL) %>% req_url_query(timestamp=ts)
if(!is.null(curs))
req <- req %>% req_url_query(pageCursor=curs)
resp <- req_perform(req)
songs <- resp |> resp_body_json()
songs
}
FIP.jsonLineToDT <- function(x) {
A <- data.table(Artist=x$firstLine,
Album=x$release$title,
Song=x$secondLine,
Year=x$release$year,
Label=x$release$label,
start=x$start,
end=x$end)
if(length(x$links)>0){
DTLinks <- as.data.table(matrix(unlist(x$links), nrow = 2))
colnames(DTLinks) <- as.character(DTLinks[1])
DTLinks <- DTLinks[-1]
A <- cbind(A, DTLinks)
}
A
}
FIP.jsonToDT <- function(js){
rbindlist(lapply(1:length(js$songs), FUN=function(i) FIP.jsonLineToDT(js$songs[[i]])), fill=T)
}
FIP.getSongForDay <- function(date){
i <- 1
curs <- NULL
ts <- as.numeric(as.POSIXct(date)+10*3600)
js <- FIP.getSongs(ts, curs)
DATA <- FIP.jsonToDT(js)
curs <- js$`next`
while(!is.null(curs) & js$songs[[1]]$end<=ts+24*3600) {
cat(curs)
js <- FIP.getSongs(ts, curs)
if(length(js$songs)>0){
DATA2 <- FIP.jsonToDT(js)
DATA <- rbind(DATA, DATA2, fill=T)
}
curs <- js$`next`
}
DATA[,start:=as.POSIXct(start, tz="Pacific/Tahiti")]
DATA[,end:=as.POSIXct(end, tz="Pacific/Tahiti")]
DATA
}
for(dt in lstDatesManquantes) {
cat(as.character(as.Date(dt)))
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
source("functions.R")
#SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
for(dt in lstDatesManquantes) {
cat(as.character(as.Date(dt)))
DATA <- FIP.getSongForDay(dt)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt)) , sep = ";", quote = T)
}
source("functions.R")
#SOUSRADIO <- "radio-reggae"  #fip, radio-reggae, radio-jazz
SOUSRADIO <- "fip"  #fip, radio-reggae, radio-jazz
URL <- sprintf("https://www.radiofrance.fr/fip/%s/api/songs", SOUSRADIO)
OUTPUTFOLDER <- sprintf("output/%s", SOUSRADIO)
## APPELS API
dt <- as.Date('2024-09-20')
dt <- Sys.Date()
isoweek()
## APPELS API
dt <- as.Date('2024-08-20')
dt <- Sys.Date()
## APPELS API
dt <- as.Date('2024-08-20')
## APPELS API
dt <- as.Date('2024-09-20')
for(i in 0:30) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
## APPELS API
dt <- as.Date('2025-12-02')
for(i in 0:30) {
cat(as.character(dt+i))
DATA <- FIP.getSongForDay(dt+i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
## APPELS API
dt <- as.Date('2025-12-31')
for(i in 0:30) {
cat(as.character(dt-i))
DATA <- FIP.getSongForDay(dt-i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt-i)) , sep = ";", quote = T)
}
## APPELS API
dt <- as.Date('2024-12-02')
for(i in 0:30) {
cat(as.character(dt+i))
DATA <- FIP.getSongForDay(dt+i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt+i)) , sep = ";", quote = T)
}
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[,start:=as.POSIXct(start)]
DATA[,end:=as.POSIXct(end)]
saveRDS(DATA, file=sprintf("output/SONGS-%s-2024.rds",  SOUSRADIO))
View(DATA)
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
## APPELS API
dt <- as.Date('2025-01-02')
for(i in 0:90) {
cat(as.character(dt+i))
DATA <- FIP.getSongForDay(dt+i)
cat(nrow(DATA))
cat("\n")
fwrite(DATA, sprintf("%s/SONGS-%s-%s.csv",OUTPUTFOLDER, SOUSRADIO, as.character(dt+i)) , sep = ";", quote = T)
}
View(DATA)
DATA <- unique(rbindlist(lapply(list.files(OUTPUTFOLDER, pattern="*.csv", full.names = T), fread), use.names = T, fill=T))
DATA[, start:=as.POSIXct(start)]
DATA[, end:=as.POSIXct(end)]
DATA[, mois:=sprintf("%04d-%02d", year(start),month(start))]
DATA[, week:=isoweek(start)]
saveRDS(DATA, file=sprintf("output/SONGS-%s.rds",  SOUSRADIO))
## ECRITURE D'UN FICHIER PAR MOIS
lstMois <- DATA[, .N, mois][,mois]
lapply(lstMois, FUN=function(x) {
fwrite(DATA[mois==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
lstWeek <- DATA[year(start)==2024, .N, week][,week]
lapply(lstWeek, FUN=function(x) {
fwrite(DATA[week==x,.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-2024-%s-2024W%02d.csv", SOUSRADIO, x), col.names = F)
#fwrite(DATA[mois==x & itunes!="",.(SOUNDIIZ=sprintf("%s - %s", Artist, Song))], sprintf("output/soundiiz/FIP-%s-%s.csv", SOUSRADIO, x))
})
